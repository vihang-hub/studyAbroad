# Implementation Plan: MVP UK Study & Migration Research App

**Branch**: `001-mvp-uk-study-migration` | **Date**: 2025-12-31 | **Spec**: [spec.md](./spec.md)
**Input**: Feature specification from `/specs/001-mvp-uk-study-migration/spec.md`

**Note**: This plan is generated by `/speckit.plan` command and is ready for implementation via `/speckit.implement`.

## Summary

Build a Gemini-style conversational web application that generates AI-powered research reports for students planning to study in the UK. The MVP supports multiple authentication providers (Google, Apple, Facebook, Email), requires payment of £2.99 per query, generates structured 10-section reports using Gemini APIs with streaming responses, and stores reports for 30 days with soft-delete retention. The system must support three environment modes (dev, test, production) with feature flags for Supabase and payments, implement comprehensive logging with rotation/retention, and maintain complete user data isolation via Row-Level Security.

**Technical Approach**: Monorepo architecture with Next.js 15+ frontend (App Router, TypeScript strict mode, Tailwind CSS), FastAPI Python backend (LangChain for AI orchestration), Supabase PostgreSQL database (with local PostgreSQL for dev mode), Clerk for authentication, Stripe for payments, and 4 shared infrastructure packages for environment configuration, feature flags, database abstraction, and structured logging.

## Technical Context

**BOOTSTRAP** (mandatory):
- Treat `.specify/memory/constitution.md` as supreme authority.
- Apply all repository skills from `.claude/skills/`:
  - SpeckitGovernance
  - QualityGates
  - RagCitationsIntegrity
  - SecurityBaselineNIST
- Enforce: no hidden features, UK-only MVP, 30-day retention, £2.99 per query, and citations required.
- All outputs must follow SpeckitGovernance file locations:
  - Spec → specs/
  - Plan → specs/plans/
  - Tasks → specs/tasks/

### Frontend Stack
**Language/Version**: TypeScript 5.3+ (Next.js 15+ App Router, Strict Mode)
**Primary Dependencies**:
- Next.js 15.1.3 (App Router with React Server Components)
- React 19.0.0
- Tailwind CSS 3.4+ with shadcn/ui components
- Clerk 6.36.5 (authentication with clerkMiddleware)
- Stripe React SDK (payment integration)
- Vercel AI SDK (streaming UI components)
- Zod 3.23+ (validation schemas)

**Storage**: None (stateless, all data in backend/Supabase)
**Testing**: Vitest 2.1.8 with @testing-library/react, Stryker Mutator for mutation testing
**Target Platform**: Web browsers (Chrome, Firefox, Safari latest 2 versions), deployed on Vercel
**Performance Goals**:
- Streaming response begins within 5 seconds (p95)
- Time to Interactive (TTI) < 3 seconds
- First Contentful Paint (FCP) < 1.5 seconds
- Core Web Vitals: LCP < 2.5s, FID < 100ms, CLS < 0.1

**Constraints**:
- Client-side bundle size < 250KB (gzipped)
- No client-side secrets (all API keys server-side only)
- Stateless (no client-side session storage beyond Clerk tokens)

**Scale/Scope**:
- Initial: 100 concurrent users
- Target: 10,000 monthly active users
- ~50 React components
- ~20 API route handlers

### Backend Stack
**Language/Version**: Python 3.12+
**Primary Dependencies**:
- FastAPI 0.115+ (async web framework)
- LangChain 0.3+ (AI orchestration and streaming)
- Google Generative AI SDK (Gemini 2.0 Flash)
- Supabase Python Client 2.11+ (database operations)
- Stripe Python SDK (payment processing)
- Pydantic 2.10+ (data validation)
- structlog (structured logging with rotation)
- asyncpg (PostgreSQL async driver)

**Storage**:
- **Development**: PostgreSQL 14+ (local, already installed)
- **Test/Production**: Supabase PostgreSQL (managed, with RLS)
- **Migrations**: Alembic for schema versioning

**Testing**: pytest 8.3+ with pytest-asyncio, pytest-cov (coverage), mutmut (mutation testing)
**Target Platform**: Google Cloud Run (containerized, autoscaling 0-100 instances)
**Performance Goals**:
- API response time p95 < 200ms (excluding AI generation)
- AI streaming first token < 5 seconds
- Support 1000 concurrent requests
- Database query time p95 < 50ms

**Constraints**:
- Stateless backend (no in-memory sessions)
- Cold start time < 2 seconds on Cloud Run
- Memory limit 512MB per instance
- Maximum AI generation time 60 seconds (timeout)

**Scale/Scope**:
- Initial: 100 requests/minute
- Target: 10,000 requests/day
- ~30 API endpoints
- ~15 database tables (including soft-deleted records)

### Shared Infrastructure Packages (TypeScript + Python)
**Packages**:
1. **@study-abroad/shared-config**: Environment configuration with Zod/Pydantic validation
2. **@study-abroad/shared-feature-flags**: Feature flag evaluation (ENABLE_SUPABASE, ENABLE_PAYMENTS)
3. **@study-abroad/shared-database**: Repository pattern with PostgreSQL/Supabase adapters, soft delete
4. **@study-abroad/shared-logging**: Structured logging with Winston/structlog, rotation (100MB OR daily), retention (configurable, default 30 days)

**Testing**: Each package requires ≥90% coverage, >80% mutation score
**Scope**: ~2000 lines of code per package (8000 total)

### Environment-Specific Configuration
**Development Mode**:
- Database: Local PostgreSQL (localhost:5432)
- Feature Flags: ENABLE_SUPABASE=false, ENABLE_PAYMENTS=false
- Logging: LOG_LEVEL=debug, file-based in `/logs`
- Secrets: `.env.local` (not committed)

**Test Mode**:
- Database: Supabase (connection string from env)
- Feature Flags: ENABLE_SUPABASE=true, ENABLE_PAYMENTS=false
- Logging: LOG_LEVEL=debug, file-based in `/logs`
- Secrets: Google Secret Manager (test project)

**Production Mode**:
- Database: Supabase (connection string from Secret Manager)
- Feature Flags: ENABLE_SUPABASE=true, ENABLE_PAYMENTS=true
- Logging: LOG_LEVEL=error, file-based in `/var/log/app`
- Secrets: Google Secret Manager (production project)

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

Verify compliance with Study Abroad Constitution (v1.0.0):

- [x] **Technical Stack Alignment**: Technology choices align with Section 1 requirements
  - ✅ Next.js 15+ App Router with TypeScript Strict Mode
  - ✅ Tailwind CSS with shadcn/ui components
  - ✅ Vercel AI SDK for streaming (not used in current impl, but available)
  - ✅ Python 3.12+ with FastAPI
  - ✅ LangChain for AI orchestration
  - ✅ Supabase PostgreSQL with RLS
  - ✅ Clerk for OAuth 2.0 authentication
  - ✅ Infrastructure: Vercel (frontend) + Google Cloud Run (backend)

- [x] **Security Framework**: Security requirements follow NIST CSF 2.0 (Section 2)
  - ✅ SBOM: Automated via npm/pip dependency tracking
  - ✅ IAM: OAuth 2.0 with Clerk (Google, Apple, Facebook, Email)
  - ✅ Zero-exposure secrets: All API keys in Google Secret Manager (production)
  - ✅ Encryption: TLS 1.3 (in-transit), AES-256 (at-rest via Supabase)
  - ✅ Logging: Structured logging with correlation IDs, sensitive data sanitization
  - ✅ Threat Model: Documented in `docs/threat-model.md` with OWASP Top 10 mitigations

- [x] **Engineering Rigor**: Testing strategy meets Section 3 standards
  - ✅ 100% spec faithfulness: All AC-1 through AC-17 requirements mapped
  - ✅ Mutation testing >80%: Stryker (frontend), mutmut (backend)
  - ✅ Code coverage ≥90%: Vitest coverage (frontend), pytest-cov (backend)
  - ✅ Test pyramid: 80% unit, 15% integration, 5% E2E
  - ✅ Clean Code: ESLint Airbnb style guide enforced
  - ✅ Functional Programming: Immutability enforced via TypeScript readonly

- [x] **Architectural Principles**: Design follows Section 4 requirements
  - ✅ Stateless autoscaling: Backend is shared-nothing, Cloud Run autoscales 0-100
  - ✅ RAG integrity: Citations mandatory (min 1 per report), tracked in database
  - ✅ Persistence: All reports mapped to userId via Clerk authentication
  - ✅ Database isolation: RLS policies enforce user-level data access
  - ✅ Soft delete: 30-day retention with deletedAt timestamp, data recovery capability

- [x] **Naming & Structure**: Conventions follow Section 5 guidelines
  - ✅ PascalCase: React components (e.g., ChatInput.tsx, ReportSection.tsx)
  - ✅ kebab-case: Directories and files (e.g., src/app/chat/, shared-config/)
  - ✅ snake_case: Database tables and columns (e.g., users, created_at, deleted_at)
  - ✅ API Design: RESTful (POST /reports, GET /reports/{id}, DELETE /reports/{id})
  - ✅ OpenAPI 3.1: Complete API spec in `docs/api/openapi.yaml`

- [x] **Prohibited Practices**: No violations of Section 6 constraints
  - ✅ No assumptions: All decisions documented in ADRs (6 total in `docs/adr/`)
  - ✅ No shadow IT: No third-party trackers, all tools explicitly defined
  - ✅ No manual deployments: GitHub Actions CI/CD for all environments
  - ✅ Infrastructure as Code: Dockerfile, Cloud Run YAML configurations

**Violations Requiring Justification**: None

**Additional Compliance**:
- ✅ **Gate1-Architecture**: PASS (17/17 checklist items) - See `agents/checklists/Gate1-Architecture.md`
- ✅ **Gate2-Design**: PASS (60/60 checklist items) - See `agents/checklists/Gate2-Design.md`
- ✅ **ADRs Created**: 6 decisions documented
  - ADR-0001: Environment configuration system (layered validation)
  - ADR-0002: Feature flag mechanism (environment variables)
  - ADR-0003: Database abstraction layer (repository + adapter pattern)
  - ADR-0004: Logging infrastructure (Winston/structlog, rotation, retention)
  - ADR-0005: Soft delete pattern (deletedAt timestamp)
  - ADR-0006: Shared component architecture (multi-package monorepo)

## Project Structure

### Documentation (this feature)

```text
specs/001-mvp-uk-study-migration/
├── spec.md              # Feature specification (COMPLETE)
├── plan.md              # This file (generated by /speckit.plan)
├── research.md          # Phase 0 output (generated by /speckit.plan)
├── data-model.md        # Phase 1 output (generated by /speckit.plan)
├── quickstart.md        # Phase 1 output (generated by /speckit.plan)
├── contracts/           # Phase 1 output (links to docs/api/openapi.yaml)
│   └── README.md        # Points to centralized OpenAPI spec
└── tasks.md             # Phase 2 output (generated by /speckit.tasks - NOT yet created)
```

### Source Code (repository root)

```
study-abroad/
├── .specify/                       # Speckit framework
│   ├── memory/
│   │   └── constitution.md        # Project constitution (v1.0.0)
│   ├── scripts/bash/              # Plan/task automation scripts
│   └── templates/                 # Spec/plan/task templates
├── .claude/                        # Claude Code configuration
│   ├── commands/                  # Custom skills (primer)
│   └── skills/                    # Repository skills
├── agents/                         # Agent definitions
│   ├── checklists/
│   │   ├── Gate1-Architecture.md  # Architecture quality gate (PASS)
│   │   ├── Gate2-Design.md        # Design quality gate (PASS)
│   │   └── Gate5-QA.md            # QA quality gate (for testing phase)
│   ├── commands/                  # Agent command definitions
│   └── roles/                     # Agent role definitions
├── docs/                           # Comprehensive documentation
│   ├── adr/                       # Architectural Decision Records (6 ADRs)
│   │   ├── ADR-0001-environment-configuration-system.md
│   │   ├── ADR-0002-feature-flag-mechanism.md
│   │   ├── ADR-0003-database-abstraction-layer.md
│   │   ├── ADR-0004-logging-infrastructure.md
│   │   ├── ADR-0005-soft-delete-pattern.md
│   │   └── ADR-0006-shared-component-architecture.md
│   ├── api/
│   │   └── openapi.yaml           # Complete OpenAPI 3.1 specification
│   ├── architecture/
│   │   ├── system-overview.md     # System architecture (v2.0.0)
│   │   └── architecture-compliance-report.md
│   ├── database/
│   │   ├── schema.sql             # PostgreSQL DDL (users, reports, payments)
│   │   └── rls-policies.sql       # Supabase Row-Level Security policies
│   ├── design/
│   │   ├── shared-component-interfaces.md  # TypeScript interfaces for shared packages
│   │   ├── error-handling.md      # Error codes, response format, correlation IDs
│   │   └── security.md            # NIST CSF 2.0, OWASP Top 10 mitigations
│   ├── diagrams/                  # Mermaid architecture diagrams (4 total)
│   │   ├── environment-architecture.mmd
│   │   ├── feature-flags-flow.mmd
│   │   ├── logging-architecture.mmd
│   │   └── shared-components.mmd
│   ├── flows/                     # UX flow diagrams (4 Mermaid)
│   │   ├── auth-flow.mmd
│   │   ├── report-generation-flow.mmd
│   │   ├── report-access-flow.mmd
│   │   └── environment-initialization-flow.mmd
│   ├── deployment/
│   │   ├── .env.dev.template      # Dev environment configuration
│   │   ├── .env.test.template     # Test environment configuration
│   │   └── .env.production.template  # Production environment configuration
│   ├── testing/
│   │   ├── test-strategy.md       # Test pyramid, coverage goals, mutation testing
│   │   └── coverage-status.md     # Current coverage tracking
│   ├── threat-model.md            # Security analysis (NIST CSF 2.0, OWASP Top 10)
│   └── CLERK-SETUP-GUIDE.md       # Step-by-step Clerk configuration
├── frontend/                       # Next.js 15+ App Router application
│   ├── src/
│   │   ├── app/                   # App Router pages
│   │   │   ├── layout.tsx         # Root layout with ClerkProvider
│   │   │   ├── page.tsx           # Home page
│   │   │   ├── chat/              # Chat interface
│   │   │   └── globals.css        # Global styles
│   │   ├── components/            # React components
│   │   │   ├── chat/              # Chat UI components
│   │   │   ├── auth/              # Authentication components
│   │   │   ├── payments/          # Payment components
│   │   │   └── ClerkWarning.tsx   # Dev mode warning banner
│   │   ├── lib/                   # Utilities
│   │   │   ├── clerk.ts           # Clerk validation helpers
│   │   │   └── startup-checks.ts  # Development mode checks
│   │   └── middleware.ts          # Clerk authentication middleware
│   ├── tests/                     # Vitest tests
│   │   ├── components/            # Component tests
│   │   └── hooks/                 # Hook tests
│   ├── .env.local                 # Local environment variables (gitignored)
│   ├── next.config.js             # Next.js configuration
│   ├── tailwind.config.ts         # Tailwind CSS configuration
│   ├── vitest.config.ts           # Vitest configuration
│   ├── stryker.conf.json          # Stryker Mutator configuration
│   └── package.json               # Frontend dependencies
├── backend/                        # FastAPI Python backend
│   ├── src/
│   │   ├── api/
│   │   │   ├── routes/            # API route handlers
│   │   │   │   ├── reports.py     # Report CRUD endpoints
│   │   │   │   ├── stream.py      # SSE streaming endpoint
│   │   │   │   ├── payments.py    # Payment endpoints
│   │   │   │   └── webhooks.py    # Stripe webhook handler
│   │   │   ├── services/          # Business logic
│   │   │   │   ├── ai_service.py  # Gemini AI integration, streaming
│   │   │   │   ├── report_service.py
│   │   │   │   └── payment_service.py
│   │   │   └── models/            # Pydantic models
│   │   │       ├── user.py
│   │   │       ├── report.py      # Report with soft delete
│   │   │       ├── payment.py
│   │   │       └── schemas.py     # Request/response schemas
│   │   ├── config.py              # Pydantic settings (environment config)
│   │   ├── feature_flags.py       # Feature flag evaluator
│   │   ├── database/              # Database layer
│   │   │   ├── repositories/      # Repository pattern implementations
│   │   │   └── adapters/          # PostgreSQL/Supabase adapters
│   │   └── logging_config.py      # Structlog configuration
│   ├── tests/                     # pytest tests
│   │   ├── test_api_endpoints.py
│   │   ├── test_ai_service.py
│   │   └── test_user_model.py
│   ├── Dockerfile                 # Cloud Run container definition
│   ├── pyproject.toml             # Python dependencies (Poetry)
│   └── pytest.ini                 # pytest configuration
├── shared/                         # Shared TypeScript packages
│   ├── config/                    # @study-abroad/shared-config
│   │   ├── src/
│   │   │   ├── schemas/
│   │   │   │   ├── environment.schema.ts  # Zod environment validation
│   │   │   │   └── api.schema.ts          # Zod API validation
│   │   │   └── index.ts
│   │   ├── tests/
│   │   ├── package.json
│   │   └── README.md              # Package documentation
│   ├── feature-flags/             # @study-abroad/shared-feature-flags
│   │   ├── src/
│   │   │   └── index.ts
│   │   ├── tests/
│   │   ├── package.json
│   │   └── README.md
│   ├── database/                  # @study-abroad/shared-database
│   │   ├── src/
│   │   │   ├── repositories/      # Repository interfaces
│   │   │   └── adapters/          # Database adapters
│   │   ├── tests/
│   │   ├── package.json
│   │   └── README.md
│   ├── logging/                   # @study-abroad/shared-logging
│   │   ├── src/
│   │   │   └── index.ts
│   │   ├── tests/
│   │   ├── package.json
│   │   └── README.md
│   ├── package.json               # Shared workspace configuration
│   ├── vitest.config.ts           # Shared Vitest configuration
│   └── stryker.conf.json          # Shared Stryker configuration
├── specs/                          # Feature specifications
│   └── 001-mvp-uk-study-migration/
│       ├── spec.md                # Feature specification (COMPLETE)
│       └── plan.md                # This file
├── infrastructure/                 # Infrastructure as Code
│   ├── docker/
│   │   └── Dockerfile.backend     # Backend container image
│   └── scripts/
│       └── deploy.sh              # Deployment automation
├── .github/
│   └── workflows/
│       ├── frontend-ci.yml        # Frontend CI/CD (Vercel)
│       ├── backend-ci.yml         # Backend CI/CD (Cloud Run)
│       └── shared-ci.yml          # Shared packages CI
├── package.json                   # Monorepo root package.json (workspaces)
├── CLAUDE.md                      # Claude Code context (auto-updated)
└── README.md                      # Project overview
```

**Structure Decision**: Monorepo with clear separation of concerns:
- **Frontend**: Next.js App Router in `frontend/` (stateless, deployed to Vercel)
- **Backend**: FastAPI in `backend/` (stateless, deployed to Cloud Run)
- **Shared**: 4 infrastructure packages in `shared/` (config, feature-flags, database, logging)
- **Documentation**: Comprehensive docs in `docs/` (architecture, API, database, flows, testing)
- **Specifications**: Feature specs in `specs/` following Speckit governance

## Complexity Tracking

> **Fill ONLY if Constitution Check has violations that must be justified**

| Violation | Why Needed | Simpler Alternative Rejected Because |
|-----------|------------|-------------------------------------|
| None | N/A | N/A |

**Note**: All complexity introduced (4 shared packages, 3 environment modes, soft delete pattern) is explicitly required by the specification and aligns with constitutional principles. No unjustified complexity added.

## Phase 0: Research & Planning

**Status**: COMPLETE ✅ (Gate1 Architecture and Gate2 Design already passed)

All research has been completed in previous phases:
- **Architecture Phase (Gate1)**: 6 ADRs created, system architecture defined
- **Design Phase (Gate2)**: OpenAPI spec, database schemas, UX flows, component interfaces all documented

Research artifacts available in:
- `docs/adr/` - All architectural decisions documented
- `docs/architecture/system-overview.md` - Comprehensive system architecture
- `docs/design/` - Complete design documentation

**Unknowns Resolved**:
1. ✅ Local database choice → PostgreSQL (already installed)
2. ✅ Feature flag mechanism → Environment variables
3. ✅ Log rotation strategy → Hybrid (100MB OR daily)
4. ✅ Post-30-day behavior → Soft delete with deletedAt
5. ✅ Log retention period → Configurable (default 30 days)

No additional research needed. Proceed to Phase 1.

## Phase 1: Data Model & Contracts

**Status**: COMPLETE ✅ (All design artifacts created in Gate2)

### Data Model
**Location**: `docs/database/schema.sql` and `docs/database/rls-policies.sql`

**Entities**:
1. **users** table:
   - `id` (UUID, PK)
   - `clerk_user_id` (TEXT, UNIQUE) - External auth ID
   - `email` (TEXT, UNIQUE)
   - `created_at` (TIMESTAMP)
   - RLS Policy: Users can read own record only

2. **reports** table:
   - `id` (UUID, PK)
   - `user_id` (UUID, FK to users)
   - `subject` (TEXT) - Field of study
   - `country` (TEXT) - Fixed to 'UK' for MVP
   - `content` (JSONB) - Structured report with 10 sections
   - `citations` (JSONB) - Array of citation objects
   - `created_at` (TIMESTAMP)
   - `expires_at` (TIMESTAMP) - created_at + 30 days
   - `deleted_at` (TIMESTAMP, NULLABLE) - Soft delete timestamp
   - RLS Policy: Users can access own non-deleted reports only

3. **payments** table:
   - `id` (UUID, PK)
   - `user_id` (UUID, FK to users)
   - `report_id` (UUID, FK to reports, NULLABLE initially)
   - `amount` (INTEGER) - 299 (pence)
   - `currency` (TEXT) - 'GBP'
   - `status` (TEXT) - 'pending', 'succeeded', 'failed', 'canceled'
   - `stripe_payment_intent_id` (TEXT, UNIQUE)
   - `created_at` (TIMESTAMP)
   - RLS Policy: Users can read own payments only

**Relationships**:
- One user → Many reports (1:N)
- One user → Many payments (1:N)
- One payment → One report (1:1, optional until payment succeeds)

**Indexes**:
- `idx_reports_user_id` on reports(user_id)
- `idx_reports_deleted_at` on reports(deleted_at) - Partial index WHERE deleted_at IS NULL
- `idx_payments_user_id` on payments(user_id)
- `idx_payments_stripe_id` on payments(stripe_payment_intent_id)

**Triggers**:
- `set_expires_at_trigger`: Auto-set expires_at = created_at + INTERVAL '30 days'
- `soft_delete_trigger`: Auto-set deleted_at when expires_at < NOW()

### API Contracts
**Location**: `docs/api/openapi.yaml` (OpenAPI 3.1 specification)

**Key Endpoints**:

1. **POST /api/reports** - Create new report (with payment check)
   - Request: `{ "subject": "Computer Science", "paymentIntentId": "pi_xxx" }`
   - Response: `{ "reportId": "uuid", "status": "generating" }`
   - Feature Flag: Bypasses payment if ENABLE_PAYMENTS=false

2. **GET /api/reports** - List user's reports
   - Query: `?limit=20&offset=0`
   - Response: `{ "reports": [...], "total": 42 }`
   - Filters: Excludes soft-deleted (deleted_at IS NOT NULL)

3. **GET /api/reports/{id}** - Retrieve specific report
   - Response: Full report with all 10 sections + citations
   - Error: 404 if soft-deleted or not owned by user

4. **GET /api/stream/reports/{id}** - SSE streaming endpoint
   - Server-Sent Events stream
   - Events: `start`, `chunk` (content tokens), `section` (progress), `complete`

5. **POST /api/payments/create-intent** - Create Stripe PaymentIntent
   - Request: `{ "amount": 299, "currency": "GBP" }`
   - Response: `{ "clientSecret": "pi_xxx_secret_yyy" }`

6. **POST /api/webhooks/stripe** - Stripe webhook handler
   - Events: `payment_intent.succeeded`, `payment_intent.payment_failed`
   - Signature verification required

7. **GET /api/health** - Health check (environment-aware)
   - Response: `{ "status": "healthy", "environment": "dev", "features": {...} }`

### Quickstart
**Location**: `specs/001-mvp-uk-study-migration/quickstart.md` (to be created)

Will contain:
- Prerequisites (Node.js 18+, Python 3.12+, PostgreSQL 14+)
- Installation steps (npm install, pip install)
- Environment setup (.env.local configuration)
- Database migration (Alembic)
- Running dev servers (npm run dev, uvicorn)
- Running tests (npm test, pytest)

## Phase 2: Implementation Tasks

**Status**: NOT STARTED (requires `/speckit.tasks` command)

Tasks will be generated in `specs/001-mvp-uk-study-migration/tasks.md` covering:

1. **Shared Infrastructure Packages** (4 packages × ~10 tasks each = ~40 tasks):
   - Implement @study-abroad/shared-config
   - Implement @study-abroad/shared-feature-flags
   - Implement @study-abroad/shared-database
   - Implement @study-abroad/shared-logging
   - Write unit tests (≥90% coverage)
   - Configure mutation testing (>80% score)

2. **Backend Implementation** (~30 tasks):
   - Database schema migration
   - RLS policy implementation
   - Repository pattern implementation
   - API endpoint handlers
   - Gemini AI integration with streaming
   - Stripe payment integration
   - Webhook handlers
   - Feature flag integration
   - Logging configuration
   - Unit + integration tests

3. **Frontend Implementation** (~25 tasks):
   - Page components (home, chat)
   - Chat UI components
   - Authentication flow (Clerk integration)
   - Payment flow (Stripe integration)
   - Report display components
   - Streaming UI implementation
   - Feature flag integration
   - Error handling with correlation IDs
   - Unit + integration tests

4. **Integration & E2E** (~10 tasks):
   - End-to-end user flows
   - Environment-specific testing (dev, test, production configs)
   - Performance testing
   - Security testing
   - Load testing

5. **Documentation & Deployment** (~10 tasks):
   - Update README.md
   - Create quickstart.md
   - Deployment scripts (Vercel, Cloud Run)
   - CI/CD pipeline configuration
   - Monitoring setup
   - Production secrets configuration

**Total Estimated Tasks**: ~115 tasks

## Constitution Re-Check (Post-Design)

*Re-verification after Phase 1 design completion:*

- [x] **Technical Stack Alignment**: ✅ PASS - All technology choices implemented as specified
- [x] **Security Framework**: ✅ PASS - NIST CSF 2.0 compliance verified in threat model
- [x] **Engineering Rigor**: ✅ PASS - Test strategy documented with coverage/mutation goals
- [x] **Architectural Principles**: ✅ PASS - Stateless design, RAG citations, user isolation all confirmed
- [x] **Naming & Structure**: ✅ PASS - All naming conventions followed in design artifacts
- [x] **Prohibited Practices**: ✅ PASS - No violations introduced during design phase

**Final Constitution Compliance**: ✅ 6/6 PASS

**Gate Status**:
- Gate1 (Architecture): ✅ PASS (17/17 checklist items)
- Gate2 (Design): ✅ PASS (60/60 checklist items)
- Gate3 (Implementation): ⏳ PENDING (awaiting `/speckit.tasks` and implementation)

## Next Steps

1. **Run `/speckit.tasks`** to generate dependency-ordered task breakdown in `tasks.md`
2. **Begin implementation** following task order (shared packages → backend → frontend)
3. **Maintain quality gates**:
   - Code coverage ≥90% (enforced by CI)
   - Mutation score >80% (Stryker/mutmut)
   - All tests passing before deployment
4. **Deploy to environments**:
   - Dev: Local setup (PostgreSQL, no payments)
   - Test: Supabase + GitHub Actions
   - Production: Vercel + Cloud Run + Secret Manager

**Implementation Ready**: ✅ All design artifacts complete, ready for task generation and coding.
